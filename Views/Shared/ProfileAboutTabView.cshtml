@model FollowPeers.Models.UserProfile
@using FollowPeers.Models;
@{
    //at first, assume must check credentials, and assume all show is false.
    ViewBag.Title = "ProfileNoticeBoardTabView";
    bool toCheck = true;
    bool showEmail = false;
    bool showPhone = false;
    bool showMobile = false;
    bool showAddress = false;
    bool showEducation = false;
    bool showPublication = false;
    bool showPatent = false;
    bool showAboutMe = false;
    bool showCourse = false;
    bool showEmployment = false;
    bool showNoticeBoard = false;
    FollowPeers.Models.FollowPeersDBEntities followPeersDB = new FollowPeers.Models.FollowPeersDBEntities();
    List<FollowPeers.Models.Achievement> myAchievements = followPeersDB.Achievements.Where(p => p.UserProfileId == Model.UserProfileId).ToList();
}

@if (Membership.GetUser().UserName == Model.UserName)
{
    toCheck = false; //if you are viewing your own profile, no need to check privacy
}
@{
    //tocheck true means this is not your profile
    if (toCheck == true)
    {
        string membername = Membership.GetUser().UserName;


        IQueryable<int> custQuery = from cust in followPeersDB.Relationships where cust.personAName == membername && cust.personBName == Model.UserName select cust.tier;

        //if such a member exists in the relationships, we can proceed to check access
        if (custQuery.Count() != 0)
        {
            //check if the user has tier1 access for the information of the profile
            foreach (int tier in custQuery)
            {
                FollowPeers.Models.Tier temp = Model.Tiers.SingleOrDefault(p => p.Level == tier);
                if (temp.Email == 1) { showEmail = true; }
                if (temp.Phone == 1) { showPhone = true; }
                if (temp.Mobile == 1) { showMobile = true; }
                if (temp.Address == 1) { showAddress = true; }
                if (temp.Education == 1) { showEducation = true; }
                if (temp.Publication == 1) { showPublication = true; }
                if (temp.Patent == 1) { showPatent = true; }
                if (temp.AboutMe == 1) { showAboutMe = true; }
                if (temp.Employment == 1) { showEmployment = true; }
                if (temp.Noticeboard == 1) { showNoticeBoard = true; }
            }
        }

        //else (meaning public view.. so check if the user has declared the information as public, or tier1. tier1 means must have access to see)
        //notice board will not be visible to someone not in the peers
        else
        {
            FollowPeers.Models.Tier temp = Model.Tiers.SingleOrDefault(p => p.Level == 1);
            if (temp.Email == 1) { showEmail = true; }
            if (temp.Phone == 1) { showPhone = true; }
            if (temp.Mobile == 1) { showMobile = true; }
            if (temp.Address == 1) { showAddress = true; }
            if (temp.Education == 1) { showEducation = true; }
            if (temp.Publication == 1) { showPublication = true; }
            if (temp.Patent == 1) { showPatent = true; }
            if (temp.AboutMe == 1) { showAboutMe = true; }
            if (temp.Employment == 1) { showEmployment = true; }

        }
    } 
}

<head>
    <title>About Tab</title>
    <style>
        #about-label
        {
            color: #0094ff;
            border-right: solid 1px grey;
            padding-right:5px;
        }
    </style>
</head>

<div id="about">
    @{
        string name = Membership.GetUser().UserName;
        FollowPeers.Models.UserProfile myprofile = followPeersDB.UserProfiles.SingleOrDefault(p => p.UserName == name);
        
        <fieldset>

            <legend>Personal</legend>
            

                <table>
                <tr>
                    <td id="about-label"><p>Gender</p></td>
                   
                    <td id="about-value"><p>@Html.Label(Model.Gender)</p></td>
                </tr>
            </table>
          
            
        </fieldset>
    }
</div>
